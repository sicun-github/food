(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/addOrder/addOrder"],{"1bd4":function(e,t,r){"use strict";var n=r("5b50"),o=r.n(n);o.a},2568:function(e,t,r){"use strict";r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){return n}));var n={uNotify:function(){return Promise.all([r.e("common/vendor"),r.e("uni_modules/uview-ui/components/u-notify/u-notify")]).then(r.bind(null,"6a80"))}},o=function(){var e=this.$createElement;this._self._c},a=[]},"2d20":function(e,t,r){"use strict";(function(e,t){var n=r("4ea4");r("8035"),r("a9ff");n(r("66fd"));var o=n(r("782f"));e.__webpack_require_UNI_MP_PLUGIN__=r,t(o.default)}).call(this,r("bc2e")["default"],r("543d")["createPage"])},"5ae8":function(e,t,r){"use strict";(function(e,n){var o=r("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(r("2eee")),u=o(r("9523")),c=o(r("c973")),s=(o(r("8150")),r("26cb"));function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,u.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var f=e.importObject("voucher"),l=e.importObject("order"),p=e.importObject("address"),h={data:function(){return{cart:[],deno:"",voucher_id:"",voucher_user_id:"",amount:"",remark:"",phone:"",address:""}},watch:{voucher_id:{handler:function(e){var t=this;return(0,c.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!e){r.next=5;break}return r.next=3,f.getVoucherById(t.voucher_id);case 3:n=r.sent,t.deno=n.deno;case 5:case"end":return r.stop()}}),r)})))()}}},computed:d(d({},(0,s.mapState)({shop_id:function(e){return e.order.shop_id},takein:function(e){return e.order.takein},user_id:function(e){return e.user.openid}})),{},{totalNum:function(){var e=0;return this.cart.forEach((function(t){e+=t.num})),e},totalPrice:function(){var e=0;this.cart.forEach((function(t){e+=t.meal_price*t.num}));var t=e.toFixed(2);return this.deno&&(t-=this.deno,t<=0&&(t=0),t=t.toFixed(2)),t},getCode:function(){var e=""+(parseInt(100*Math.random())+100);return e="1"+e.substring(1,7),e}}),onLoad:function(e){console.log(e.cart);var t=JSON.parse(e.cart);this.cart=t,console.log("cart:",t),this.getdefaultInfo()},methods:{getdefaultInfo:function(){var e=this;return(0,c.default)(a.default.mark((function t(){var r,n;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,p.getUserAddress(e.user_id);case 2:r=t.sent,r.length>0?(n=r.findIndex((function(e){return 1==e.isdefault})),-1!=n?(e.phone=r[n].phone,e.takein||(e.address=r[n].address,console.log(e.address))):e.$store.state.user.userinfo.user_phone&&(e.phone=e.$store.state.user.userinfo.user_phone)):e.$store.state.user.userinfo.user_phone&&(e.phone=e.$store.state.user.userinfo.user_phone);case 4:case"end":return t.stop()}}),t)})))()},gotoRemark:function(){n.navigateTo({url:"/pages/order/remark/remark"})},gotoSelectCoupon:function(){n.navigateTo({url:"/pages/purchase/selectCoupon/selectCoupon"})},gotoAddress:function(){n.navigateTo({url:"/pages/user/address/address"})},addOrder:function(){var e=this;return(0,c.default)(a.default.mark((function t(){var r,o,u,c;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.phone){t.next=21;break}return r=n.getStorageSync("openid"),console.log(e.address),o={user_id:r,actual_price:e.totalPrice,remark:e.remark,phone:e.phone,address:e.address},e.voucher_user_id&&(o.voucher_id=e.voucher_user_id,console.log("订单里有优惠券：",e.voucher_user_id)),e.takein&&(o.num=e.getCode),u=[],e.cart.forEach((function(t){u.push({shop_id:e.shop_id,meal_id:t._id,meal_price:t.meal_price,num:t.num})})),o.goods_list=u,t.prev=9,t.next=12,l.createOrder(o);case 12:c=t.sent,200==c.code&&(e.$store.dispatch("getUserInfo"),e.$refs.uNotify.primary("下单成功！"),setTimeout((function(){n.navigateBack()}),1e3)),t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](9),n.showToast({title:"下单失败！",icon:"error"});case 19:t.next=22;break;case 21:n.showToast({title:"请输入手机号！",icon:"error"});case 22:case"end":return t.stop()}}),t,null,[[9,16]])})))()}}};t.default=h}).call(this,r("a9ff")["default"],r("543d")["default"])},"5b50":function(e,t,r){},"782f":function(e,t,r){"use strict";r.r(t);var n=r("2568"),o=r("9e3e");for(var a in o)["default"].indexOf(a)<0&&function(e){r.d(t,e,(function(){return o[e]}))}(a);r("1bd4");var u=r("f0c5"),c=Object(u["a"])(o["default"],n["b"],n["c"],!1,null,"ca96cd56",null,!1,n["a"],void 0);t["default"]=c.exports},"9e3e":function(e,t,r){"use strict";r.r(t);var n=r("5ae8"),o=r.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(a);t["default"]=o.a}},[["2d20","common/runtime","common/vendor"]]]);